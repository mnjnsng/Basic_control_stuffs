A = [0 0 -10 0;
     0 0 0 10;
     3.315 -3.315 -0.5882 -0.5882;
     3.315 -3.315 -0.5882 -0.5882];
B = [0 0; 0 0; 8.533 0; 0 8.533];
C = [0.5 0.5 0 0;
     -2.113 2.113 0.375 0.375];
D = zeros(2,2);

sysc = ss(A,B,eye(4),zeros(4,2));
sysd = c2d(sysc,0.05);

Phi = sysd.A;
Gamma = sysd.B;

% Full state feedback
Hw = [0.5 0.5 0 0;
     -2.113 2.113 0.375 0.375;
     0 0 0.5 0.5];
Q1 = Hw'*0.1*eye(3)*Hw;
Q2 = eye(2);

K = dlqr(Phi,Gamma,Q1,Q2);

% Integral control
Phi_a = [1 -2.113 2.113 0.375 0.375;
         0  0.9599    0.0401   -0.4861    0.0139;
         0  0.0401    0.9599   -0.0139    0.4861;
         0 0.1566   -0.1566    0.9321   -0.0679;
         0 0.1566   -0.1566   -0.0679    0.9321];
Gamma_a = [0 0;
          -0.1049    0.0017;
          -0.0017    0.1049;
           0.4148   -0.0118;
          -0.0118    0.4148];
temp = cat(2,[0;0;0],Hw);
H_I = [-2.113 2.113 0.375 0.375];
Hw_a = cat(1, temp, [1 0 0 0 0]);
N_x = [1 -0.2366;
       1 0.2366;
       0 0;
       0 0];

Q1 = Hw_a'*0.1*eye(4)*Hw_a;
Q2 = eye(2);

K_a = dlqr(Phi_a,Gamma_a,Q1,Q2);
K_I = K_a(:,1);
K = K_a(:,2:5);


%Estimator
H_e = [0.5 0.5 0 0;
       -2.113 2.113 0.375 0.375];

Rv = [0.0004 0; 0 0.0001];
Rw = [0.0001 0; 0 0.0001];

%LTR
mu = sqrt(2)/2;
T = 0.05;
temp = T*inv(Phi-eye(4))*Gamma*inv(C*inv(Phi-eye(4))*Gamma);
temp2 = -T*inv(C*inv(Phi-eye(4))*Gamma);
L = cat(1,temp,temp2);
